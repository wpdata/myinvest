# 🔧 参数优化器快速修复指南

## 问题：数据不足错误

```
ValueError: Insufficient data: 919 days available, 1095 days required
```

---

## 解决方案（2选1）

### 方案 1: 扩大日期范围（✅ 推荐）

**修改开始日期，确保至少3年数据：**

```
开始日期: 2022-01-23 或更早  ← 计算公式：今天 - 1095天
结束日期: 2025-10-23 (今天)

数据范围: 1095+ 天 ✅
```

**当前日期对应的推荐开始日期：**

| 今天日期 | 推荐开始日期 | 说明 |
|---------|-------------|------|
| 2025-10-23 | 2022-10-23 或更早 | 需要3年数据 |
| 2025-01-01 | 2022-01-01 或更早 | 需要3年数据 |
| 2024-06-01 | 2021-06-01 或更早 | 需要3年数据 |

**操作步骤：**
1. 在优化器页面，找到侧边栏"开始日期"输入框
2. 改为 **2022-01-01** 或更早
3. 点击"开始优化"

---

### 方案 2: 关闭前推验证（⚡ 最快）

如果你只想快速测试参数优化，可以暂时关闭前推验证：

**操作步骤：**
1. 在侧边栏找到 **"高级设置"** 展开
2. 取消勾选 **"启用前推验证"** ✅ → ❌
3. 现在只需要 **365天（1年）** 数据即可
4. 点击"开始优化"

**注意：** 关闭前推验证后，无法检测过拟合风险！

---

## 推荐配置（确保成功）

### 配置 A: 完整验证（推荐）

```yaml
股票代码: 600519.SH

日期范围:
  开始: 2021-01-01  ← 至少4年
  结束: 2025-01-01

参数范围:
  止损: 5-25% (步长5) → 5个值
  止盈: 10-40% (步长5) → 7个值
  仓位: 10-40% (步长10) → 4个值

总组合: 5 × 7 × 4 = 140 种
预计耗时: ~5分钟

高级设置:
  ✅ 启用前推验证
  优化目标: 夏普比率
```

---

### 配置 B: 快速测试（不推荐，仅用于验证系统工作）

```yaml
股票代码: 600519.SH

日期范围:
  开始: 2024-01-01  ← 仅1年
  结束: 2025-01-01

参数范围:
  止损: 5-15% (步长5) → 3个值
  止盈: 10-30% (步长10) → 3个值
  仓位: 20-20% (步长10) → 1个值 (固定)

总组合: 3 × 3 × 1 = 9 种
预计耗时: ~30秒

高级设置:
  ❌ 禁用前推验证  ← 关键
  优化目标: 夏普比率
```

---

## 为什么需要3年数据？

前推验证需要：
- **训练期：2年（730天）** - 用于优化参数
- **测试期：1年（365天）** - 用于验证参数
- **总计：3年（1095天）** 最低要求

**目的：** 防止过拟合（在历史数据上表现好，但实盘会亏钱）

---

## 常见错误和解决方案

### 错误 1: "919 days available, 1095 days required"

**原因：** 开始日期太晚
**解决：** 改为 2022-01-01 或更早

---

### 错误 2: "未找到有效的参数组合"

**原因：** 策略在该时期没有触发任何信号
**解决：**
1. 扩大参数范围
2. 换一个股票（如沪深300ETF: 510300.SH）
3. 选择不同的策略

---

### 错误 3: "API数据获取失败"

**原因：** 网络问题或API限流
**解决：**
1. 检查网络连接
2. 等待1-2分钟后重试
3. 使用缓存数据（`prefer_cache=True`）

---

## 测试配置是否正确

运行这个快速检查：

```python
from datetime import datetime, timedelta

# 你的配置
start_date = datetime(2020, 1, 1)
end_date = datetime.now()

# 计算天数
days_diff = (end_date - start_date).days

print(f"数据范围: {days_diff} 天")
print(f"是否足够: {'✅ 是' if days_diff >= 1095 else '❌ 否'}")

if days_diff < 1095:
    required_start = end_date - timedelta(days=1095)
    print(f"推荐开始日期: {required_start.strftime('%Y-%m-%d')}")
```

---

## 立即可用的日期配置

**复制粘贴这些日期：**

```
# 4年数据（推荐）
开始: 2021-10-23
结束: 2025-10-23

# 5年数据（更稳健）
开始: 2020-10-23
结束: 2025-10-23

# 6年数据（最佳）
开始: 2019-10-23
结束: 2025-10-23
```

---

现在试试优化器，应该可以正常工作了！ 🚀
