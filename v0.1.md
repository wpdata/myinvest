# MyInvest — 智能投资分析系统

  ## Project Intent

  Develop MyInvest, an intelligent investment analysis and operation system that helps individual investors record, analyze, and optimize their investment behavior through data-driven insights and strategy
  recommendations, while maintaining strict risk controls and human oversight over all financial decisions.

  ---

  ## Overview

  MyInvest 将作为一个个人投资分析与实盘辅助系统，整合个人历史投资记录（包括股票、期货等），并结合市场的历史与实时行情数据，自动生成投资分析与操作建议。系统将基于历史回测、专家咨询（参考"Kroll"与"Livermore"的投
  资哲学与策略模型）以及主流量化投资策略，提供智能化的投资指导。

  在实盘阶段，系统应能明确指出：
  - 当天应投资的品种
  - 建仓、止盈、止损的具体价格位置
  - 预期收益与最大可能损失
  - 不同市场情境下的操作建议（加仓/减仓/止损动作）

  系统提供直观的可操作界面来执行与跟踪这些投资操作，但**所有涉及真实资金的操作必须经过用户明确批准**，系统绝不自动执行交易。

  ---

  ## Core Functional Requirements

  ### 1. 投资数据记录与管理模块

  **功能描述：**
  - 用户可以手动或自动导入个人历史投资数据（包括股票、期货、基金等）
  - 记录内容包括：投资标的、买入金额、价格、时间、仓位比例、卖出时间与收益
  - 支持多账户、多品种的数据管理
  - 提供投资总览（资产分布、收益曲线、风险指标等）

  **输入/输出：**
  - 输入：CSV/Excel 导入，或手动表单录入
  - 输出：投资记录列表、收益曲线图、资产分布饼图

  **数据完整性要求：**
  - 每条投资记录必须标注数据来源（券商账单/手动录入/API导入）
  - 记录时间戳（录入时间、交易时间）
  - 导入数据需经过基本验证（价格 > 0、日期合法、标的代码格式正确）
  - 数据异常时显示警告，不自动修正

  **界面交互：**
  - 提供"导入投资记录"按钮
  - 显示投资记录表格，支持排序、筛选
  - 显示历史收益曲线图（按日/周/月）
  - 显示资产分布（按品种/行业）

  ---

  ### 2. 市场数据整合模块

  **功能描述：**
  - 系统可接入主流行情接口（股票与期货市场的历史与实时数据）
  - 用户可选择订阅的市场或品种
  - 提供基础图表（K线、均线、成交量、波动率曲线）

  **数据源要求：**
  - 支持至少一个主流行情 API（如 Tushare/AKShare/efinance/新浪财经等）
  - 历史数据：至少支持最近 3 年的日线数据
  - 实时数据：延迟 < 5 秒（如 API 支持）

  **数据质量保障：**
  - 所有行情数据必须包含：
    - 数据源标识（如 "Tushare v1.2.85"）
    - 数据时间戳（精确到秒）
    - 数据新鲜度标签（"实时" / "延迟 15 分钟" / "历史数据"）
  - API 调用失败时：
    - 换另外的接口调用，如果都不行就降级到本地缓存的历史数据
    - 在界面显著位置显示警告："当前使用历史数据，更新于 [时间]"
    - 系统不崩溃，保持可用性

  **界面交互：**
  - 提供标的搜索框（输入代码或名称）
  - 显示 K 线图（可切换日线/周线/月线）
  - 显示数据新鲜度指示器（绿色=实时，黄色=延迟，灰色=历史）

  ---

  ### 3. 策略与专家意见引擎

  **功能描述：**
  - 内置两类投资思想模型：
    - **Kroll 模型**：注重稳健与风险控制
    - **Livermore 模型**：偏向趋势捕捉与资金管理
  - 用户可在策略配置中调整权重（例如 60% Kroll + 40% Livermore）
  - 系统还内置若干主流量化策略（如动量策略、均值回归、波段操作等）
  - 系统根据用户的投资风格与历史表现，生成个性化的投资建议

  **AI Advisor 架构要求：**
  - Kroll 与 Livermore 必须以 **Google ADK Agent** 形式实现
  - 每个 Advisor 作为独立模块（`investlib-advisors/kroll`、`investlib-advisors/livermore`）
  - Advisor 的提示词（prompts）必须：
    - 版本化存储（如 `kroll-advisor-v1.0.md`）
    - 使用语义化版本号（semver）
    - 每次建议时记录使用的提示词版本

  **Advisor 输出格式：**

  每个 Advisor 的建议必须包含以下结构化信息：

  ```json
  {
    "advisor": "Kroll",
    "advisor_version": "v1.0.0",
    "timestamp": "2025-10-14T10:30:00Z",
    "recommendation": {
      "action": "BUY" | "SELL" | "HOLD",
      "symbol": "600519.SH",
      "entry_price": 1680.00,
      "stop_loss": 1620.00,
      "take_profit": 1800.00,
      "position_size_pct": 15,
      "max_loss_amount": 9000.00,
      "expected_return_pct": 7.14
    },
    "reasoning": {
      "why": "价格突破 120 日均线，成交量放大 30%，符合趋势启动特征",
      "confidence": "HIGH" | "MEDIUM" | "LOW",
      "key_factors": ["突破关键阻力位", "成交量确认", "行业利好"],
      "historical_precedents": "2023-03-15 类似形态，后续上涨 12%"
    },
    "data_version": {
      "market_data_timestamp": "2025-10-14T10:28:00Z",
      "data_source": "Tushare v1.2.85"
    }
  }

  策略融合逻辑：
  - 系统收集所有 Advisor 的建议
  - 按用户设定的权重计算综合评分
  - 生成最终建议时，优先采用置信度高且多个 Advisor 一致的信号
  - 给出决策过程的解释

  界面交互：
  - 显示"专家意见"面板，列出 Kroll 与 Livermore 的独立建议
  - 显示"综合建议"（融合后的最终建议）
  - 可点击查看每个 Advisor 的推理过程
  - 可调整 Advisor 权重滑块（Kroll 0-100%, Livermore 0-100%）

  ---
  4. 回测与审批模块

  功能描述：
  - 用户可对系统生成的策略进行历史回测
  - 显示策略在过去一段时间内的收益率、最大回撤、夏普比率等
  - 提供"审批"流程：用户或管理员确认策略可进入实盘执行

  回测要求：
  - 支持指定时间范围（如 2022-01-01 至 2024-12-31）
  - 回测必须使用真实历史数据（从市场数据 API 获取）
  - 回测结果包括：
    - 累计收益率
    - 年化收益率
    - 最大回撤（MaxDrawdown）
    - 夏普比率（Sharpe Ratio）
    - 胜率（Win Rate）
    - 交易次数
  - 回测结果必须可视化（收益曲线、回撤曲线）

  审批流程：
  - 回测完成后，显示"提交审批"按钮
  - 用户可添加审批备注
  - 审批通过后，策略状态变为"已批准，可进入实盘"
  - 审批记录包括：审批人、审批时间、审批意见

  界面交互：
  - 提供"回测设置"表单（选择策略、时间范围、初始资金）
  - 显示回测进度条
  - 显示回测结果报告（表格 + 图表）
  - 显示审批状态标签（"待审批" / "已批准" / "已拒绝"）

  ---
  5. 实盘决策与操作界面

  功能描述：
  - 界面显示当前推荐的投资标的与操作建议：
    - 买入/卖出信号
    - 建仓点位、止盈止损位置
    - 预计收益与最大可能损失
    - 实时盈亏跟踪
  - 用户可直接在界面执行模拟下单操作（v0.1 不接入真实交易接口）
  - 每次操作后，系统记录操作日志，并更新个人投资历史

  投资安全要求（强制性）：

  所有投资建议必须包含以下强制字段：
  - ✅ 入场价格（Entry Price）
  - ✅ 止损价格（Stop Loss） — 必填，系统拒绝无止损的建议
  - ✅ 止盈价格（Take Profit）
  - ✅ 仓位大小（Position Size %）
  - ✅ 最大损失金额（Max Loss Amount，基于止损计算）
  - ✅ 预期收益（Expected Return %）

  操作审批流程（强制性）：

  1. 系统生成建议后，以"卡片"形式展示
  2. 卡片显示所有关键信息（标的、价格、止损、止盈、最大损失）
  3. 用户必须点击"确认执行"按钮，系统才记录操作
  4. 用户可以"修改后执行"（调整止损、仓位等）
  5. 系统记录：
    - 原始建议（系统生成）
    - 用户修改（如有）
    - 执行确认时间与用户 ID
    - 执行方式（模拟交易 / 实盘交易）

  模拟交易 vs 实盘交易：
  - v0.1 仅支持"模拟交易模式"
  - 界面顶部必须显著标识当前模式（如大号标签："当前模式：模拟交易"）
  - 模拟交易的操作记录到独立的"模拟账本"
  - 未来实盘模式需要额外的安全确认（如输入交易密码）

  止损验证：
  - 系统拒绝无止损的建议（后端校验）
  - 界面显示"止损缺失"错误提示
  - 止损价格必须合理（如不能大于入场价，做多时）

  仓位验证：
  - 系统计算当前总仓位（已持有 + 待建仓）
  - 如果超过总资金 100%，拒绝操作并提示"资金不足"
  - 单笔操作仓位建议不超过总资金 20%（可配置）

  界面交互：
  - 显示"今日推荐"卡片列表，每个卡片包含：
    - 标的名称与代码
    - 操作类型（买入/卖出/持有）
    - 入场价、止损、止盈
    - 最大损失（醒目红色显示）
    - "确认执行"按钮
  - 点击"确认执行"后，弹出二次确认对话框
  - 执行后，卡片移至"已执行记录"区域
  - 提供"操作日志"页面，显示所有历史操作

  ---
  6. 投资建议解释模块（Explainability）

  功能描述：
  - 对每次系统给出的投资建议，提供解释：
    - 哪个策略模型发出了信号
    - 信号依据的市场特征（如价格突破、成交量变化、波动率上升等）
    - 历史上类似情形下的成功率与平均收益

  解释内容结构：

  建议：买入 贵州茅台（600519.SH）

  【触发策略】
  ✓ Livermore 趋势跟随策略（置信度：高）
  ✓ 动量策略（置信度：中）

  【市场信号】
  • 价格突破 120 日均线（1650 → 1680）
  • 成交量较 20 日均量放大 30%
  • MACD 金叉形成

  【历史相似案例】
  2023-03-15：相似突破形态，后续 15 日上涨 12%
  2022-11-08：相似形态，后续 10 日上涨 8%
  历史成功率：68%（22/32 次）

  【Kroll 意见】
  偏谨慎，建议仓位不超过 10%（当前建议 15%）

  【数据依据】
  市场数据：Tushare，更新于 2025-10-14 10:28（实时）
  使用 Advisor 版本：Livermore v1.0.0

  界面交互：
  - 每个建议卡片有"查看详细解释"按钮
  - 点击后展开或弹出解释面板
  - 解释内容分层显示（策略 → 信号 → 历史案例）

  ---
  7. 界面与交互要求

  主界面布局：

  主界面包括以下主要区块：

  1. 顶部导航栏
    - Logo 与标题："MyInvest"
    - 模式指示器："模拟交易模式"（大号，醒目）
    - 快捷菜单：首页 / 投资记录 / 策略配置 / 回测 / 设置
  2. 投资概览面板（首页左侧）
    - 总资产
    - 今日盈亏（金额 + 百分比）
    - 累计收益曲线图（折线图）
    - 资产分布饼图（按品种）
    - 当前持仓列表（标的、数量、成本、当前价、盈亏）
  3. 实盘建议面板（首页右侧）
    - "今日推荐"卡片列表（最多显示 5 个）
    - 每个卡片显示：标的、操作、价格、止损、止盈、最大损失
    - "确认执行"按钮
    - "查看详细解释"链接
  4. 策略配置与专家意见面板（独立页面）
    - Advisor 权重调整滑块
    - 显示 Kroll 与 Livermore 的独立建议列表
    - 显示综合建议
  5. 数据回测与结果展示区（独立页面）
    - 回测设置表单
    - 回测结果表格与图表
    - 审批按钮与状态
  6. 操作日志页面（独立页面）
    - 操作记录表格（时间、标的、操作、价格、状态）
    - 支持按时间、标的筛选

  交互要求：
  - 核心操作（查看建议、执行模拟交易）不超过 3 次点击
  - 所有涉及资金的操作需要二次确认弹窗
  - 加载数据时显示进度指示器（loading spinner）
  - 错误提示使用醒目颜色（红色）并明确说明原因

  模式切换：
  - 支持一键切换"模拟交易模式"与"实盘模式"（v0.1 仅支持模拟模式）
  - 切换时显示警告弹窗："确认切换到实盘模式？实盘操作将涉及真实资金。"
  - 实盘模式需要额外的安全验证（v0.1 不实现）

  日志与审计：
  - 每次操作均记录到操作日志表
  - 日志字段：操作 ID、时间戳、用户 ID、操作类型、标的、价格、状态、备注
  - 日志不可修改，仅可查看

  ---
  Technical Architecture

  Technology Stack

  - 框架：Google ADK
    - 用于 UI 编排和 Agent 协调
    - Kroll 与 Livermore 实现为 Google ADK Agents
  - 编程语言：Python 3.10+
  - 数据库：
    - v0.1：SQLite（原型阶段）
    - 生产版：PostgreSQL
  - 市场数据 API：
    - 主要数据源：Tushare（或 efinance）
    - 备用数据源：AKShare（如 Tushare或efinance 不可用）
  - 界面技术：
    - Web UI（推荐 Streamlit 或 Gradio，与 Google ADK 集成）
    - 或 Google ADK 自带的 UI 组件
  - 可视化库：Plotly 或 ECharts（用于图表）

  System Architecture

  ┌─────────────────────────────────────────────────┐
  │         Google ADK Orchestration Layer          │
  │  (Main App: investapp)                          │
  └─────────────────────────────────────────────────┘
                 │
                 ├─────────────────────────────────┐
                 │                                 │
         ┌───────▼──────┐                 ┌────────▼────────┐
         │  investlib-  │                 │  investlib-     │
         │  data        │                 │  advisors       │
         │              │                 │                 │
         │ • 数据采集   │                 │ • Kroll Agent   │
         │ • 数据存储   │                 │ • Livermore     │
         │ • 数据验证   │                 │   Agent         │
         └──────────────┘                 └─────────────────┘
                 │
         ┌───────▼──────┐                 ┌────────▼────────┐
         │  investlib-  │                 │  investlib-     │
         │  quant       │                 │  backtest       │
         │              │                 │                 │
         │ • 策略计算   │                 │ • 回测引擎      │
         │ • 信号生成   │                 │ • 绩效评估      │
         └──────────────┘                 └─────────────────┘

  Data Flow

  Market Data API → investlib-data → Database
                                        ↓
  Personal Investment Records ────→ Database
                                        ↓
                           investlib-quant (策略计算)
                                        ↓
                      investlib-advisors (Kroll, Livermore)
                                        ↓
                           investapp (综合建议生成)
                                        ↓
                                UI Display
                                        ↓
                           User Confirmation
                                        ↓
                      Operation Log → Database

  Library Design

  所有核心逻辑必须以 investlib-* 库的形式实现：

  1. investlib-data
    - 职责：市场数据采集、个人投资记录管理
    - CLI：investlib-data fetch --symbol 600519.SH --start 2023-01-01
    - 输出：JSON 格式的行情数据
  2. investlib-quant
    - 职责：量化策略计算、交易信号生成
    - CLI：investlib-quant signal --strategy livermore --data input.json
    - 输出：JSON 格式的交易信号
  3. investlib-advisors
    - 职责：Kroll 与 Livermore AI Advisor 实现
    - CLI：investlib-advisors ask --advisor kroll --context market_data.json
    - 输出：JSON 格式的建议（包含推理过程）
  4. investlib-backtest
    - 职责：策略回测、绩效评估
    - CLI：investlib-backtest run --strategy livermore --period 2023-01-01:2024-12-31
    - 输出：JSON 格式的回测结果
  5. investapp
    - 职责：UI 编排、用户交互、流程协调
    - 不包含业务逻辑，仅调用上述库

  CLI 要求：
  - 所有库必须提供 --help 文档
  - 支持 --dry-run 模式（不实际执行，仅显示将要执行的操作）
  - 支持 --output json 输出结构化数据
  - 支持标准输入/输出管道（可用 | 连接）

  ---
  Data Quality & Safety Requirements

  Data Integrity Requirements

  所有数据源必须可追溯、版本化、经过验证：

  个人投资历史数据：
  - 必须包含字段：
    - source：数据来源（"manual_entry" / "broker_statement" / "api_import"）
    - ingestion_timestamp：数据录入时间（ISO 8601 格式）
    - checksum：数据验证哈希（SHA256）
  - 数据验证规则：
    - 价格 > 0
    - 数量 > 0
    - 交易日期 <= 今天
    - 标的代码符合格式（如 6 位数字 + 后缀）

  市场数据：
  - 必须包含字段：
    - api_source：数据源名称与版本（如 "Tushare v1.2.85"）
    - retrieval_timestamp：数据获取时间
    - adjustment_method：价格调整方法（"前复权" / "后复权" / "不复权"）
  - 数据新鲜度标签：
    - "实时"：延迟 < 5 秒
    - "延迟 15 分钟"：延迟 5 秒 ~ 15 分钟
    - "历史数据"：延迟 > 15 分钟

  数据异常处理：
  - 数据验证失败时：
    - 记录错误日志（包含原始数据、错误原因）
    - 在界面显示警告："数据验证失败：[原因]"
    - 不自动修正数据
  - 数据缺失时：
    - 在界面显示警告："数据不完整，部分功能可能不可用"
    - 系统继续运行，使用可用数据

  投资决策数据版本：
  - 每次生成建议时，记录使用的数据版本：
    - 市场数据时间戳
    - Advisor 提示词版本
    - 策略代码版本（Git commit hash）
  - 用户可查看"建议详情"中的数据版本信息

  ---
  Investment Safety Requirements (NON-NEGOTIABLE)

  强制性安全规则：

  1. 止损强制性
    - 所有买入/做多建议必须包含止损价格
    - 后端验证：if recommendation.stop_loss is None: raise ValueError("止损缺失")
    - 前端验证：止损输入框必填
  2. 仓位限制
    - 单笔操作默认不超过总资金 20%（可配置）
    - 总仓位不超过 100%
    - 超限时拒绝操作，显示错误："仓位超限，当前可用资金不足"
  3. 最大损失计算
    - 系统自动计算：max_loss = position_size * (entry_price - stop_loss)
    - 在建议卡片醒目位置显示（红色大字）
    - 用户必须看到此信息才能确认操作
  4. 操作审批流程
    - 所有操作必须经过用户点击"确认执行"
    - 显示二次确认弹窗：
    确认执行以下操作？

  买入：贵州茅台（600519.SH）
  入场价：1680 元
  止损价：1620 元
  仓位：15%（约 45000 元）
  最大可能损失：2700 元

  [取消]  [确认执行]
    - 系统记录操作日志（时间、用户、操作、状态）
  5. 模拟 vs 实盘区分
    - v0.1 仅支持"模拟交易模式"
    - 界面顶部大号标签："当前模式：模拟交易"（绿色背景）
    - 未来实盘模式标签："当前模式：实盘交易"（红色背景）
    - 模式切换需要额外确认
  6. 无自动交易
    - 系统绝不自动执行交易，即使用户配置了"自动跟单"
    - 所有操作必须经过人工确认

  审计日志：
  - 所有操作记录到 operation_log 表
  - 字段：
    - operation_id（UUID）
    - timestamp（ISO 8601）
    - user_id（v0.1 可为固定值 "default_user"）
    - operation_type（"BUY" / "SELL" / "MODIFY" / "CANCEL"）
    - symbol（标的代码）
    - original_recommendation（JSON，系统原始建议）
    - user_modification（JSON，用户修改内容）
    - execution_status（"PENDING" / "EXECUTED" / "CANCELLED"）
    - notes（用户备注）
  - 日志表为 append-only，不允许修改或删除

  ---
  Scope for Initial Phase (v0.1)

  In Scope for v0.1

  v0.1 聚焦核心功能验证，限定范围如下：

  ✅ 包含功能：

  1. 基础数据管理
    - 支持手动导入历史投资记录（CSV 或表单录入）
    - 显示投资总览（总资产、累计收益曲线、持仓列表）
    - 数据验证与完整性检查
  2. 市场数据集成
    - 接入 Tushare API（或 AKShare）
    - 获取单个标的的历史日线数据（最近 1 年）
    - 显示基础 K 线图
  3. 单一策略实现
    - 实现 Livermore 趋势跟随策略（单一策略）
    - 生成买入/卖出信号
    - 信号包含：入场价、止损价、止盈价、仓位建议
  4. 投资建议展示
    - 显示"今日推荐"卡片（最多 3 个）
    - 卡片包含所有必填字段（入场、止损、止盈、最大损失）
    - 显示简化版解释（触发策略、关键信号）
  5. 模拟交易执行
    - 用户可点击"确认执行"记录模拟交易
    - 显示二次确认弹窗
    - 记录操作日志到数据库
    - 更新持仓列表
  6. 基础界面
    - Web UI（使用 Streamlit 或 Gradio）
    - 包含页面：首页（投资概览 + 今日推荐）、投资记录、操作日志
    - 顶部显示"模拟交易模式"标签

  ✅ 技术实现：
  - Python + Google ADK
  - SQLite 数据库
  - Tushare API
  - Streamlit UI
  - 实现 investlib-data 和 investlib-quant 基础功能
  - Livermore Advisor 实现为 Google ADK Agent

  ---
  Out of Scope for v0.1

  ❌ 不包含功能：

  1. 多策略融合
    - ❌ Kroll 策略（v0.2 实现）
    - ❌ 策略权重调整
    - ❌ 多策略综合打分
  2. 回测功能
    - ❌ 历史回测引擎（v0.2 实现）
    - ❌ 绩效指标计算（夏普比率、最大回撤等）
    - ❌ 回测报告生成
  3. 真实交易接口
    - ❌ 券商 API 对接
    - ❌ 实盘模式
    - ❌ 真实下单功能
  4. 高级功能
    - ❌ 多用户支持
    - ❌ 用户登录与权限管理
    - ❌ 移动端 UI
    - ❌ 实时推送通知
    - ❌ 自动化定时任务（如每日自动生成建议）
    - ❌ A/B 测试不同提示词版本
  5. 高级数据功能
    - ❌ 分钟级实时数据
    - ❌ 多数据源融合
    - ❌ 数据异常自动修复

  ---
  Success Criteria for v0.1

  v0.1 完成的标准：

  ✅ 功能完整性：
  - 用户可以成功导入至少 10 条历史投资记录
  - 系统可以基于 Livermore 策略给出至少 1 个标的的买入/卖出建议
  - 建议包含所有必填字段：入场点、止损点、止盈点、仓位、最大损失、预期收益
  - 用户可以执行模拟交易并在界面上看到记录
  - 收益曲线图可以正确显示历史收益变化
  - 所有操作都有日志记录，可以在"操作日志"页面查看

  ✅ 数据质量：
  - 市场数据包含数据源、时间戳、新鲜度标签
  - 导入的投资记录经过验证（价格 > 0、日期合法等）
  - 数据验证失败时显示明确的错误提示

  ✅ 安全性：
  - 所有建议包含止损价格（后端验证）
  - 操作前显示二次确认弹窗
  - 最大损失金额在界面醒目位置显示
  - 界面顶部显示"模拟交易模式"标签

  ✅ 可用性：
  - 核心操作（查看建议 → 确认执行）不超过 3 次点击
  - 页面加载时间 < 3 秒
  - K 线图可以正确渲染

  ✅ 技术架构：
  - investlib-data 提供 CLI 接口（支持 --help、--output json）
  - investlib-quant 提供 CLI 接口
  - Livermore Advisor 实现为 Google ADK Agent
  - 所有库有基础的单元测试

  ---
  Non-Functional Requirements

  Performance

  - 数据加载：首页加载时间 < 3 秒
  - 行情更新：实时模式下行情数据更新延迟 < 5 秒
  - 回测速度：回测 1 年日线数据 < 10 秒（v0.2 实现）

  Reliability

  - 数据源容错：
    - API 调用失败时自动重试（最多 3 次）
    - 重试失败后降级到本地缓存数据
    - 系统不崩溃，显示警告信息
  - 数据完整性：
    - 数据库写入失败时回滚事务
    - 关键操作（如确认交易）使用事务保证原子性

  Usability

  - 操作简便性：
    - 核心操作不超过 3 次点击
    - 所有操作提供即时反馈（loading spinner、成功/失败提示）
  - 错误提示清晰：
    - 错误信息使用简洁的中文描述
    - 提供可能的解决方案（如"数据不足，请先导入投资记录"）

  Security

  - 数据存储：
    - 本地 SQLite 数据库文件权限设置为仅当前用户可读写
    - 未来支持数据库密码加密（v0.2）
  - API 密钥管理：
    - Tushare API Token 存储在环境变量或配置文件（不提交到 Git）
    - 配置文件权限设置为仅当前用户可读

  Auditability

  - 操作日志：
    - 所有投资操作记录到 operation_log 表
    - 日志不可修改，仅可查看
    - 日志保留时间：永久（或至少 5 年）
  - 数据版本：
    - 每次建议记录使用的数据版本、策略版本、Advisor 版本
    - 可通过"建议详情"查看完整版本信息

  Maintainability

  - 代码组织：
    - 严格遵守 Library-First 原则
    - 所有业务逻辑在 investlib-* 库中实现
    - investapp 仅负责 UI 编排
  - 测试覆盖：
    - 所有库提供单元测试（覆盖率 > 80%）
    - 关键流程提供集成测试（使用真实数据库、真实 API）
  - 文档：
    - 每个库提供 README（功能说明、CLI 用法、API 文档）
    - 代码中关键函数提供 docstring

  ---
  Risk Analysis & Mitigation

  Technical Risks

  | Risk                | Impact | Probability | Mitigation                            |
  |---------------------|--------|-------------|---------------------------------------|
  | Tushare API 限流或不可用  | High   | Medium      | 实现本地数据缓存；提供备用数据源（AKShare）             |
  | Google ADK 学习曲线陡峭   | Medium | High        | 先用 Streamlit 实现 v0.1，后续迁移到 Google ADK |
  | SQLite 性能不足（大量历史数据） | Medium | Low         | v0.1 仅存储 1 年数据；v0.2 迁移到 PostgreSQL    |
  | Advisor 生成的建议质量不稳定  | High   | Medium      | 提供"置信度"标签；用户可忽略低置信度建议                 |

  Business Risks

  | Risk         | Impact | Probability | Mitigation                         |
  |--------------|--------|-------------|------------------------------------|
  | 用户误操作导致实盘亏损  | High   | High        | v0.1 仅支持模拟交易；实盘模式需额外安全确认           |
  | 策略回测过拟合      | High   | Medium      | 使用 out-of-sample 数据验证；强制 3 种市场环境测试 |
  | 数据质量问题导致错误决策 | High   | Medium      | 强制数据验证；数据异常时显著警告                   |

  ---
  Goal

  最终目标是构建一个**"个人量化投顾系统"**，在保留用户投资决策权的同时，提供数据驱动、可解释、可回测的智能辅助决策能力，帮助个人投资者以更系统化的方式进行投资操作。

  核心价值主张：
  - ✅ 数据驱动：基于真实市场数据与个人历史数据，而非主观臆断
  - ✅ 可解释：每个建议都有明确的推理过程与历史案例支持
  - ✅ 可回测：策略可以在历史数据上验证，避免过度自信
  - ✅ 风险可控：强制止损、仓位管理、操作审批，保护资金安全
  - ✅ 人机协作：AI 提供建议，人类做最终决策，而非黑盒自动交易